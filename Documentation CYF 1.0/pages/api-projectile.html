<!DOCTYPE html>
<!--
since you're here anyway: there's a small easter egg on the text commands page but it's probably not worth finding, sorry
you may notice this page's code is garbage: i'm not a web designer! ;-;
it's w3c valid, at least
-->

<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="favicon.ico">

    <title>CYF Documentation - Projectile management</title>
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/bootstrap-theme.min.css" rel="stylesheet">
    <link href="../css/themesidebar.css" rel="stylesheet">
    <link href="../css/shThemeRDark.css" rel="stylesheet">

    <!-- Syntax highlighting -->
    <script type="text/javascript" src="../js/shCore.js"></script>
    <script type="text/javascript" src="../js/shBrushLua.js"></script>
    <script type="text/javascript">SyntaxHighlighter.all();</script>
</head>
<body>
<img src="../img/bg2.png" alt="Undertale background" class="backimg">
<div class="container arena black">
    <div class="col-md-2">
        <!--navigation-->
        <nav class="nav-sidebar">
            <ul class="nav tabs">
                <li class="li-header">Basics</li>
                    <li><a href="../documentation.html">Welcome</a></li>
                    <li><a href="howtoread.html">How to read this documentation</a></li>
                    <hr style="margin-top:-2.5px;margin-bottom:2.5px;">
                    <li><a href="controls.html">Controls</a></li>
                    <li><a href="basic.html">Basic setup</a></li>
                    <li><a href="unity.html"><span class="CYF"></span> Unity Setup (Optional)</a></li>
                    <li><a href="variables.html">Special Variables</a></li>
                    <li><a href="terms.html">Terminology</a></li>
                <li class="li-header">API</li>
                    <li><a href="api-text.html">Text commands</a></li>
                    <li class="new"><a href="api-events.html">Game events</a></li>
                    <hr style="margin-top:-2.5px;margin-bottom:2.5px;">
                    <li class="li-indent">Functions &amp; Objects:</li>
                        <li class="li-indent new"><a href="api-functions-main.html">Misc. Functions</a></li>
                        <li class="li-indent new"><a href="api-functions-player.html">The Player Object</a></li>
                        <li class="li-indent"><a href="api-functions-script.html">The Script Object</a></li>
                        <li class="li-indent"><a href="api-functions-audio.html">The Audio Object</a></li>
                        <li class="li-indent"><a href="api-functions-newaudio.html"><span class="CYF"></span> The NewAudio Object</a></li>
                        <li class="li-indent"><a href="api-functions-input.html">The Input Object</a></li>
                        <li class="li-indent"><a href="api-functions-time.html">The Time Object</a></li>
                        <li class="li-indent"><a href="cyf-inventory.html"><span class="CYF"></span> The Inventory Object</a></li>
                        <li class="li-indent new"><a href="api-functions-misc.html"><span class="CYF"></span>The Misc Object</a></li>
                        <li class="li-indent new"><a href="api-functions-discord.html"><span class="CYF"></span> The Discord Object</a></li>
                        <li class="li-indent"><a href="api-functions-waves.html">The Arena Object</a></li>
                    <hr style="margin-top:-2.5px;margin-bottom:2.5px;">
                    <li class="active" style="margin-left:5px;">&gt; Projectile management &lt;</li>
                    <li><a href="cyf-ppcollision.html"><span class="CYF"></span> The Pixel-Perfect Collision System</a></li>
                    <li class="new"><a href="api-animation.html">Sprites &amp; Animation</a></li>
                    <li class="new"><a href="cyf-text.html"><span class="CYF"></span> The Text Object</a></li>
                    <hr style="margin-top:-2.5px;margin-bottom:2.5px;">
                <li class="li-header"></span><span class="CYF"></span> <span class="new"></span>Shaders</li>
                    <li><a href="shaders.html">Introduction</a></li>
                    <li><a href="shaders-object.html">The Shader Object</a></li>
                    <li><a href="shaders-coding.html">Coding a Shader</a></li>
                    <hr style="margin-top:10px;margin-bottom:10px;">
                <li class="li-header"><span class="CYF"></span> Overworld</li>
                    <li class="new"><a href="overworld.html">Basics</a></li>
                    <li><a href="overworld-howto-map.html">How to create a map</a></li>
                    <li><a href="overworld-howto-event.html">How to create an event</a></li>
                    <li><a href="overworld-howto-animevent.html">How to animate an event</a></li>
                    <li class="new"><a href="overworld-howto-shop.html">How to create a shop</a></li>
                    <hr style="margin-top:-2.5px;margin-bottom:2.5px;">
                    <li class="li-indent"><span class="CYF"></span> Overworld Objects:</li>
                        <li class="li-indent"><a href="overworld-object-general.html">The General Object</a></li>
                        <li class="li-indent"><a href="overworld-object-event.html">The Event Object</a></li>
                        <li class="li-indent"><a href="overworld-object-player.html">The Player Object</a></li>
                        <li class="li-indent"><a href="overworld-object-screen.html">The Screen Object</a></li>
                        <li class="li-indent"><a href="overworld-object-inventory.html">The Inventory Object</a></li>
                        <li class="li-indent new"><a href="overworld-object-map.html">The Map Object</a></li>
                    <hr style="margin-top:-2.5px;margin-bottom:2.5px;">
                <li class="li-header">Resources</li>
                    <li><a href="../media/dialogoptions.png">Dialog bubble names</a></li>
                    <li><a href="api-keys.html"><span class="CYF"></span> Key List</a></li>
            </ul>
        </nav>
    </div>
    <!--tabs'n'shit-->
    <div class="tab-content col-md-10">
        <div class="tab-pane active text-style" id="api-projectile">
            <h2>Projectile management</h2><br><br>
            <p>Projectile management is, starting from 0.2.0, available from both the encounter and the wave scripts. As
                a result it is now in its own section.</p>
            <p>
                <br><span class="function"><span class="CYF"></span>CreateProjectileLayer(<span class="string"></span> name,
                <span class="string"></span> position = "", <span class="boolean"></span> below = false) [E/W]</span>
                Creates a layer named <span class="term">name</span> that projectiles can be placed in. To create your new projectile layer, you'll need to choose a pre-existing layer.
                <br><br>
                <span class="term">position</span> must be the name of an existing projectile layer.<br>
                The only default layer is <span class="term">""</span>, so <b>you must use it first</b>.
                <br><br>
                If <span class="term">before</span> is true, the new layer will be created below the layer given in <span class="term">position</span>,
                otherwise it will be above it.
            </p>

            <p>
                <br><span class="function">CreateProjectile(<span class="string"></span> spritename, <span class="number"></span> initial_x,
                <span class="number"></span> initial_y,<span class="CYF"></span> <span class="string"></span> layer = "") returns <span class="userdata">bullet</span> [E/W]</span>
                Creates a bullet that you can store and modify, with its spawn position relative to the center of the
                arena. The hitbox of the bullet is a rectangle around the sprite, unless you use CYF's PP mode.<br>
                <span class="CYF"></span> You can specify a layer if you want - otherwise, the bullet will be in the normal bullet layer.
            </p>

            <p>
                <br><span class="function">CreateProjectileAbs(<span class="string"></span> spritename, <span class="number"></span> initial_x,
                <span class="number"></span> initial_y,<span class="CYF"></span> <span class="string"></span> layer = "") returns <span class="userdata">bullet</span> [E/W]</span>
                Same as <span class="term">CreateProjectile</span>, but the bullet's spawn position is relative to the bottom left of the screen instead of
                the arena's center. The hitbox of the bullet is a rectangle around the sprite, unless you use CYF's PP mode.<br>
                <span class="CYF"></span> You can specify a layer if you want - otherwise, the bullet will be in the normal bullet layer.
            </p>

            <p>
                <hr>
                <h4>The Bullet object</h4>
                This is what you use to move around the arena and store values in. You can store a bunch of bullets in a table
                and modify them. The functions and variables you can use on a Bullet are as follows.</p>
            </p>
            <p>
                <br><span class="function"><span class="userdata">sprite</span> Bullet.sprite</span>
                The bullet's sprite component. See the <span class="ref">Sprites &amp; Animation</span> section for usage details.
                <br><br>
                NOTE: In 0.2.1a, modifying the sprite does not change the bullet's hitbox yet. it's always
                the original square of the bullet when it was created.
                <br><br>
                <span class="CYF"></span> But, in CYF, changing the bullet's sprite <i>does</i> modify the bullet's hitbox!
            </p>
            <p>
                <br><span class="function"><span class="number"></span> Bullet.x</span>
                The X position of this bullet, relative to the arena's center. A bullet at
                <span class="term">x=0</span> and <span class="term">y=0</span> will be at the center of the arena.
            </p>
            <p>
                <br><span class="function"><span class="number"></span> Bullet.y</span>
                The Y position of this bullet, relative to the arena's center.
            </p>
            <p>
                <br><span class="function"><span class="number"></span> Bullet.absx</span>
                The X position of this bullet, relative to the bottom-left corner of the screen.
            </p>
            <p>
                <br><span class="function"><span class="number"></span> Bullet.absy</span>
                The Y position of this bullet, relative to the bottom-left corner of the screen.
            </p>
            <p>
                <br><span class="function"><span class="CYF"></span> <span class="boolean"></span> Bullet.ppcollision</span>
                If this is true, the bullet will use the Pixel-Perfect Collision system.
                <br><br>
                By default, this is the encounter's <b style="color:#fff">default</b> collision system.
                <br><br>
                <font color="#fff">* Manually setting this will set <span class="term">Bullet.ppchanged</span> to true.</font>
                <br><br>
                See <span class="term">SetPPCollision</span> in <span class="ref">The Pixel-Perfect Collision System</span> for more information.
            </p>
            <p>
                <br><span class="function"><span class="CYF"></span> <span class="boolean"></span> Bullet.ppchanged (read-only)</span>
                Tells you if the bullet's collision system has been changed by manually changing <span class="term">Bullet.ppcollision</span>.
                <br><br>
                <font color="#fff">* Bullets with <span class="term">Bullet.ppchanged</span> set to true will NOT be affected by future calls of<br>
                <span class="term">SetPPCollision</span> (see <span class="ref">The Pixel-Perfect Collision System</span>).</font>
                <br><br>
                Will be false after you call <span class="term">Bullet.ResetCollisionSystem()</span>, or if you haven't changed
                <span class="term">Bullet.ppcollision</span>.
            </p>
            <p>
                <br><span class="function"><span class="CYF"></span> Bullet.ResetCollisionSystem()</span>
                Resets the collision system of the bullet to the encounter's <b style="color:#fff">default</b> collision system.
                <br><br>
                The default collision system is set by <span class="term">SetPPCollision</span>.<br>
                See <span class="ref">The Pixel-Perfect Collision System</span> for more information.
            </p>
            <p>
                <br><span class="function"><span class="CYF"></span> <span class="string"></span> Bullet.layer</span>
                The bullet layer that the bullet is on.
                <br><br>
                Set it back to <span class="term">""</span> to return the bullet to the default layer.
            </p>
            <p>
                <br><span class="function"><span class="boolean"></span> Bullet.isactive (read-only)</span>
                Used to check if the bullet is still active.
                <br><br>
                If the bullet has been removed, this will be <span class="term">false</span>; otherwise <span class="term">true</span>.
            </p>
            <p>
                <br><span class="function">Bullet.Move(<span class="number"></span> x, <span class="number"></span> y)</span>
                Move this bullet <span class="term">x</span> pixels to the right and <span class="term">y</span> pixels up.
                <br><br>
                A negative <span class="term">x</span> will move it to the left, and a negative
                <span class="term">y</span> will move it downwards.
            </p>
            <p>
                <br><span class="function">Bullet.MoveTo(<span class="number"></span> x, <span class="number"></span> y)</span>
                Move this bullet to this position immediately, relative to the arena's center.
            </p>
            <p>
                <br><span class="function">Bullet.MoveToAbs(<span class="number"></span> x, <span class="number"></span> y)</span>
                Move this bullet to this position immediately, relative to the bottom-left corner of the screen.
            </p>
            <p>
                <br><span class="function">Bullet.Remove()</span>
                Destroys this bullet.
                <br><br>
                You can continue retrieving its <span class="term">x</span>,
                <span class="term">y</span>, <span class="term">absx</span> and <span class="term">absy</span>
                properties. Trying to move a removed bullet will give you a Lua error. If you're not sure if your
                bullet still exists, check <span class="term">Bullet.isactive</span> first.
            </p>
            <p>
                <br><span class="function">Bullet[<span class="string"></span> your_variable_name] = value <font style="color:#fff">(OR)</font></span>
                <span class="function">Bullet.SetVar(<span class="string"></span> your_variable_name, value)</span>
                Sets a variable on this bullet that you can retrieve with <span class="term">Bullet.GetVar</span>.
                <br><br>
                Similar in use to <span class="term">SetGlobal</span> - but you can use this to store specific variables on a per-bullet basis.
            </p>
            <p>
                <br><span class="function">Bullet[<span class="string"></span> your_variable_name] <font style="color:#fff">(OR)</font></span>
                <span class="function">Bullet.GetVar(<span class="string"></span> your_variable_name)</span>
                Gets a variable that you previously set using <span class="term">Bullet.SetVar</span>.
            </p>
            <p>
                <br><span class="function">Bullet.SendToTop()</span>
                Moves this bullet on top of all currently existing projectiles.
                <br><br>
                Note that newly spawned projectiles are always on top by default;
                this function is mostly to move existing bullets to the top.
                <br><br>
                <span class="CYF"></span> Moves the bullet to the top of its current layer.
            </p>
            <p>
                <br><span class="function">Bullet.SendToBottom()</span>
                Moves this bullet below all currently existing projectiles.
                <br><br>
                <span class="CYF"></span> Moves the bullet to the bottom of its current layer.
            </p>
            <p>
                <br><span class="function"><span class="CYF"></span> Bullet.isColliding()</span>
                Returns true if the player is colliding with the bullet.
                <br><br>
                Will use PPCollision (pixel-perfect collisions) if the bullet has PP enabled. See <span class="term">Bullet.ppcollision</span>.</li><br>
            </p>
            <p>
                <br><span class="function"><span class="CYF"></span> <span class="boolean"></span> Bullet.isPersistent = false</span>
                Set this to true and, if you're not in retrocompatibility mode, this will make the bullet stay loaded even after the wave ends.
            </p>
            <br><hr><br>
            <p>Here is an example of a bullet that chases you pretty fast, but slows down as it gets closer. You have to
                keep moving to dodge it. This is a fairly basic example that makes use of the Player object.</p>
            <div class="code-container">
<pre class="brush: lua;">oursprite = "hOI!!!!"
--Create a new bullet, starting in the upper right corner.
chasingbullet = CreateProjectile(oursprite, Arena.width/2, Arena.height/2)
--Set initial speed of 0 in both directions.
chasingbullet.SetVar('xspeed', 0)
chasingbullet.SetVar('yspeed', 0)

function Update()
    -- Get the x/y difference between the player and bullet
    local xdifference = Player.x - chasingbullet.x
    local ydifference = Player.y - chasingbullet.y
    -- We create a new speed by first halving the original speed
    -- Then we add a small fraction of the position difference between the player and bullet.
    -- The result is a bullet that moves faster as it's further away, and slower when it's closer.
    -- The value we're dividing by is experimental. Experimenting with numbers is essential!
    local xspeed = chasingbullet.GetVar('xspeed') / 2 + xdifference / 100
    local yspeed = chasingbullet.GetVar('yspeed') / 2 + ydifference / 100
    -- Now move the bullet...
    chasingbullet.Move(xspeed, yspeed)
    -- ...and store our new speeds.
    chasingbullet.SetVar('xspeed', xspeed)
    chasingbullet.SetVar('yspeed', yspeed)
end
</pre>
            </div>
            <p>Below is an example of a fully scripted Wave using most of these functions. It will spawn a projectile
                above the arena (assuming a width/height of 155/130), give it a random speed in the X direction, and
                drop it downwards. If it hits the bottom border of the arena, it'll bounce back up. Otherwise it'll
                continue falling off the screen.</p>
            <div class="code-container">
<pre class="brush: lua;">spawntimer = 0
bullets = {}

-- This happens every frame while you're defending. --
function Update()
    spawntimer = spawntimer + 1 --Add 1 to the counter every frame

    -- This part takes care of bullet spawning. --
    if spawntimer%30 == 0 then  --This happens every 30 frames.
        local posx = 30 - math.random(60) --Set a random X position between -30 and 30
        local posy = 65 --and set the Y position to 65, on the top edge of the arena.
        local bullet = CreateProjectile('hOI!!!!', posx, posy) -- Create projectile with sprite hOI!!!!.png
        bullet.SetVar('velx', 1 - 2*math.random()) -- We'll use this for horizontal speed. Random between -1/1
        bullet.SetVar('vely', 0) -- We'll use this for fall speed. We're starting without downward movement.
        table.insert(bullets, bullet) -- Add this new Bullet object to the bullets table up there.
    end

    -- This part updates every bullet in the bullets table. --
    for i=1,#bullets do -- #bullets in Lua means 'length of bullets table'.
        local bullet = bullets[i] -- For convenience, so we don't have to use bullets[i]
        local velx = bullet.GetVar('velx') -- Get the X/Y velocity we just set
        local vely = bullet.GetVar('vely')
        local newposx = bullet.x + velx -- New position will be old position + velocity
        local newposy = bullet.y + vely
        if(bullet.x &gt; -Arena.width/2 and bullet.x &lt; Arena.width/2) then -- Are we inside the arena (horizontally)?
            if(bullet.y &lt; -Arena.height/2 + 8) then -- And did we go past the bottom edge?
                bullet.MoveTo(bullet.x, -Arena.height/2 + 8) -- Don't move it past the edge!
                -- Note the +8; I know the bullet sprite I'm using is 16x16.
                -- Without adding 8 it'll be inside the edge.
                vely = 4 --reverse bounce direction
            end
        end
        vely = vely - 0.04 -- Apply gravity
        bullet.MoveTo(newposx, newposy) -- and finally, move our bullet
        bullet.SetVar('vely', vely) -- and store our new fall speed into the bullet again.
    end
end </pre>
            </div>

            <p>
                <br><span class="function">OnHit(<span class="userdata">bullet</span> bullet)</span>
                Every time a bullet collides with a player, this function gets called on the script that created the
                projectile. The bullet object in this function can be modified if you feel like it. For more information
                on the bullet object, see the documentation above.<br>
                <br>
                If you implement this function in your script, you have to manually define what should happen after
                bullet collision. This is what allows you to create orange, cyan and green projectiles, and much much
                more. If you don't implement this function in your wave script, it'll stick to the default of dealing 3
                damage on hit. Below are multiple examples of how to use this function.</p>
<div class="code-container"><pre class="brush:lua;">--Defining your own damage for this wave
function OnHit(bullet)
    Player.Hurt(10)
end</pre></div>
<div class="code-container"><pre class="brush:lua;">--Replicating cyan bullet functionality
function OnHit(bullet)
    if Player.isMoving then
        Player.Hurt(5)
    end
end</pre></div>
<div class="code-container"><pre class="brush:lua;">--Replicating orange bullet functionality; opposite condition of cyan
function OnHit(bullet)
    if not Player.isMoving then
        Player.Hurt(5)
    end
end</pre></div>
<div class="code-container"><pre class="brush:lua;">--Replicating green bullet functionality
function OnHit(bullet)
    Player.Heal(1)
    bullet.Remove()
end</pre></div>
        </div>

        <div class="tab-pane text-style" id="mercy">
            <h2 style="text-decoration: none; line-height:50px;">
                * YOU WON!<br>
                * You earned 0 EXP and 0 gold.<br>
                * also the nav menu is broken now
            </h2><br>
        </div>
    </div>
</div>

<div class="container">
    <div class="col-xs-3"><img class="centerbt black" alt="Undertale fake button" src="../img/fightbt_0.png" height="42">
    </div>
    <div class="col-xs-3"><img class="centerbt black" alt="Undertale fake button" src="../img/actbt_0.png" height="42">
    </div>
    <div class="col-xs-3"><img class="centerbt black" alt="Undertale fake button" src="../img/itembt_0.png" height="42">
    </div>
    <div class="col-xs-3"><a href="#mercy" data-toggle="tab"><img class="centerbt black" alt="Undertale fake button"
                                                                  src="../img/mercybt_0.png" height="42"></a>
    </div>
</div>
<br>
<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="../js/bootstrap.min.js"></script>
<script type="text/javascript" src="../js/show_hide_comments.js"></script>

<script type="text/javascript" src="../js/FontToggleButton.js"></script>
</body>
</html>